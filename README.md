# Telegram бот расписания (русский)

Бот отправляет расписание уроков по дням: кнопками и командами.

## Возможности
- Команды: `/start`, `/help`, `/today`, `/tomorrow`, `/week`.
- Кнопки: Сегодня, Завтра, дни недели и Вся неделя.
- Часовой пояс по умолчанию — Ташкент (UTC+5).

## Установка (Windows)

1. Установите Python 3.10+ с https://www.python.org/
2. Откройте PowerShell в папке проекта.
3. (Рекомендуется) Создайте виртуальное окружение:
   ```powershell
   python -m venv .venv
   .\.venv\Scripts\Activate.ps1
   ```
4. Установите зависимости:
   ```powershell
   pip install -r requirements.txt
   ```

## Получение токена бота
- Создайте бота у @BotFather в Telegram -> получите токен вида `123456:ABC-DEF...`
- Сохраните токен в переменной окружения или в файле `.env`:

### Вариант 1. Переменная окружения (сеанс PowerShell)
```powershell
$env:TELEGRAM_BOT_TOKEN="ВАШ_ТОКЕН"
```

### Вариант 2. Файл `.env`
Создайте в корне проекта файл `.env` со строкой:
```
TELEGRAM_BOT_TOKEN=ВАШ_ТОКЕН
```

## Запуск
```powershell
python bot.py
```

## Изменение расписания
Отредактируйте словарь `SCHEDULE` в файле `bot.py`. Ключи — дни недели в нижнем регистре: `"понедельник"`, `"вторник"`, `"среда"`, `"четверг"`, `"пятница"`, `"суббота"`.

## Деплой на Render (бесплатно, вебхуки)

Проект поддерживает 2 режима запуска:
- Polling (локально на вашем ПК).
- Webhook (на Render). Если установлена переменная `WEBHOOK_URL`, бот запустится в режиме вебхука автоматически.

### 1) Подготовка
- Создайте репозиторий на GitHub и залейте туда файлы этого проекта (`bot.py`, `requirements.txt`, `render.yaml`, и т.д.).
- Создайте бота в @BotFather и получите токен.

### 2) Создание сервиса на Render
1. Зайдите на https://render.com и авторизуйтесь через GitHub.
2. Нажмите New → Web Service.
3. Выберите ваш репозиторий.
4. Настройки (можно оставить как в `render.yaml`):
   - Environment: `Python`
   - Region: ближе к вам (например, Frankfurt)
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `python bot.py`
   - Plan: Free

### 3) Переменные окружения на Render
Задайте переменные на вкладке Environment:
- `TELEGRAM_BOT_TOKEN` — токен от @BotFather.
- `WEBHOOK_URL` — публичный URL вашего сервиса с путём, например:
  - после первого деплоя Render даст домен вида `https://your-service.onrender.com`
  - укажите `WEBHOOK_URL` как `https://your-service.onrender.com/webhook` (можно любой путь, главное, чтобы совпадал с тем, что вы указали здесь).
- `WEBHOOK_SECRET` — любая длинная строка (секрет). Не обязательно, но рекомендуется. Библиотека автоматически укажет этот секрет при установке вебхука, и будет проверять заголовок `X-Telegram-Bot-Api-Secret-Token`.

Переменную `PORT` на Render вручную НЕ задавайте — Render передаёт её сам, код бота её считывает.

### 4) Деплой
- Нажмите Deploy. Подождите, пока сборка завершится.
- В логах вы увидите: «Запуск в режиме Webhook» и адрес `WEBHOOK_URL`.
- Бот автоматически установит вебхук у Telegram (через `run_webhook`). Ничего дополнительно настраивать у BotFather не требуется.

### 5) Проверка
- Напишите боту в личку `/start`.
- Добавьте бота в группу и пришлите `/today` (при включённом Privacy Mode бот видит только команды, либо ответы реплаями на его сообщения).

### Частые проблемы
- 404/Health check на Render: В `render.yaml` убран `healthCheckPath`, так как встроенный сервер не отвечает на `GET /`. Это нормально.
- 403/Unauthorized: проверьте `TELEGRAM_BOT_TOKEN`.
- 401/Secret token invalid: убедитесь, что `WEBHOOK_SECRET` задан и не содержит пробелов в начале/конце, деплойте заново.
- Бот молчит: проверьте, что `WEBHOOK_URL` соответствует домену Render, сервис «Live», и в логах нет ошибок.

### Как обновлять код
- Вносите изменения локально → пуш в GitHub → Render автоматически задеплоит новую версию (если включён `autoDeploy`).
